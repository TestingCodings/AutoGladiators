<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:AutoGladiators.Client.ViewModels"
             xmlns:converters="clr-namespace:AutoGladiators.Client.Converters"
             x:Class="AutoGladiators.Client.Pages.BattlePage"
             x:Name="BattlePageRoot"
             Title="Turn-Based Battle">


    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:HpProgressConverter x:Key="HpProgressConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>

    <VerticalStackLayout Padding="20" Spacing="10">

        <!-- Enemy Info -->
        <Label Text="{Binding EnemyBot.Name}" FontSize="20" FontAttributes="Bold"/>
        <ProgressBar Progress="{Binding EnemyBot.HP, Converter={StaticResource HpProgressConverter}, ConverterParameter={Binding EnemyBot.MaxHP}}" />
        <Label Text="{Binding EnemyBot.HP, StringFormat='HP: {0}'}" />

        <!-- Spacer -->
        <BoxView HeightRequest="20"/>

        <!-- Battle Log -->
        <ScrollView HeightRequest="150">
            <Label Text="{Binding BattleLogText}" LineBreakMode="WordWrap" />
        </ScrollView>

        <!-- Spacer -->
        <BoxView HeightRequest="20"/>

        <!-- Player Info -->
        <Label Text="{Binding PlayerBot.Name}" FontSize="20" FontAttributes="Bold"/>
        <ProgressBar Progress="{Binding EnemyHpFraction}" />
        <ProgressBar Progress="{Binding PlayerHpFraction}" />
        <Label Text="{Binding PlayerBot.HP, StringFormat='HP: {0}'}" />

        <!-- Move Buttons -->
        <CollectionView ItemsSource="{Binding PlayerMoves}" SelectionMode="None">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                <Button Text="{Binding Name}"
                        Command="{Binding BindingContext.UseMoveCommand, Source={x:Reference BattlePageRoot}}"
                        CommandParameter="{Binding .}" />
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </VerticalStackLayout>
</ContentPage>
